<!DOCTYPE html>
<meta charset="UTF-8">
<html>
<head>
    <title></title>
</head>
<body>
    <h1>景點觀光展覽資訊
    <input type="text" id="searchsth"></h1>
    <table id="csie" class="table table-striped table-hover">
        <tr>
            <th>名稱</th>
            <th>地點</th>
            <th>票價</th>
        </tr>
    </table>
    
    <input id="numberPage" type="number" value="1" min="1" max="100">頁
</body>

<script>
    var openUrl = "https://cloud.culture.tw/frontsite/trans/SearchShowAction.do?method=doFindTypeJ&category=6";
    var xhr = new XMLHttpRequest();
    xhr.open('GET', openUrl, true);
    xhr.send();
    xhr.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            dataset = JSON.parse(this.responseText);
            addNewData(dataset);
        }
    };

    var currentPage = 1;
    var itemsPerPage = 10;
    var totalPages = Math.ceil(dataset.length / itemsPerPage);

    function addNewData(dataset) {
        var myTable = document.getElementById("csie");

        function displayData(page) {
            var startIndex = (page - 1) * itemsPerPage;
            var endIndex = startIndex + itemsPerPage;
            var dataToShow = dataset.slice(startIndex, endIndex);

            delOldData();

            dataToShow.forEach(function(data, index) {
                var row = myTable.insertRow(-1);
                row.insertCell(0).innerHTML = data['title'];
                row.insertCell(1).innerHTML = data['showInfo'][0]['location'];
                row.insertCell(2).innerHTML = data['showInfo'][0]['price'];
            });
        }

        displayData(currentPage);

    

        function delOldData() {
            var table = document.querySelector('table');
            var rows = table.querySelectorAll('tr');
            for (var i = 1; i < rows.length; i++) {
                rows[i].remove();
            }
        }

        document.getElementById("numberPage").addEventListener("change", function() {
            currentPage = parseInt(this.value);
            displayData(currentPage);
        });

        document.getElementById("searchsth").addEventListener("change", function() {
            mySearchFunction();
        });

        function mySearchFunction() {
            var input, filter, table, tr, td, i, txtValue;
            input = document.getElementById("searchsth");
            filter = input.value.toUpperCase();
            table = document.getElementById("csie");
            tr = table.getElementsByTagName("tr");
            for (i = 1; i < tr.length; i++) {
                td = tr[i].getElementsByTagName("td")[0];
                if (td) {
                    txtValue = td.textContent || td.innerText;
                    if (txtValue.toUpperCase().indexOf(filter) > -1) {
                        tr[i].style.display = "";
                    } else {
                        tr[i].style.display = "none";
                    }
                }
            }
        }
    }
</script>

</html>
